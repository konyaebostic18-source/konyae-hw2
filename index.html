<html>
    <head>
        
    </head>



<body>
    <h1>welcome to Konyae's Zombie Game</h1>
<script>
let p;
let zombies = [];
let bullets = [];

// images
let playerImg, shootImg, bulletImg;
let zombieImg, bigZombieImg, fastZombieImg;

// shoot animation
let shootMode = false;

// ammo
let ammo = 6;
let maxAmmo = 6;
let reloading = false;
let reloadTime = 1000;
let reloadStart = 0;

// screen flash
let flash = false;
let flashTimer = 0;
let flashDuration = 30;

// difficulty
let spawnRate = 120;
let fastestSpawnRate = 60;
let nextScoreMilestone = 4000;

// score
let score = 0;
let fontMain;

// start screen
let gameStarted = false;

// player health
let pHealth = 3;
let gameOver = false;
let gameOverSoundPlayed = false;

// sounds
let music, gunshot, reload, over;

function preload() {
  // Load assets
  playerImg = loadImage("player.png");
  shootImg = loadImage("shoot.png");
  bulletImg = loadImage("bullet.png");

  zombieImg = loadImage("zombie.png");
  bigZombieImg = loadImage("big.png");
  fastZombieImg = loadImage("fast.png");

  // Load sounds
  soundFormats('mp3', 'wav');
  music = loadSound("gameMusic.mp3");
  gunshot = loadSound("shotgunSound.wav");
  reload = loadSound("reloadSound.wav");
  over = loadSound("over.wav");

  fontMain = loadFont("orbitronRegular.ttf");
}

function setup() {
  createCanvas(550, 450);
  textFont(fontMain);
  p = new Player();
  music.loop();
}

function draw() {
  background(0);

  if (!gameStarted) {
    startScreen();
    return;
  }

  fill(255);
  textAlign(LEFT, TOP);
  text("Score: " + score, 5, 5);
  text("Ammo: " + ammo + (reloading ? " (Reloading...)" : ""), 5, 420);
  text("Health: " + pHealth, 5, 25);

  if (gameOver) {
    if (music.isPlaying()) music.pause();
    if (!gameOverSoundPlayed) {
      over.play();
      gameOverSoundPlayed = true;
    }
    textAlign(CENTER, CENTER);
    textSize(40);
    fill(255, 0, 0);
    text("GAME OVER", width/2, height/2 - 20);
    textSize(20);
    fill(255);
    text("Press R to Restart", width/2, height/2 + 30);
    return;
  }

  if (reloading && millis() - reloadStart >= reloadTime) {
    ammo = maxAmmo;
    reloading = false;
  }

  if (ammo === 0) {
    fill(255, 0, 0);
    textAlign(CENTER, CENTER);
    text("R to Reload", width/2, height/2);
  }

  if (flash) {
    flashTimer++;
    strokeWeight(30);
    stroke(255, 0, 0, 200);
    noFill();
    rectMode(CENTER);
    rect(width/2, height/2, width, height);
    if (flashTimer >= flashDuration) {
      flash = false;
      flashTimer = 0;
    }
  }

  if (frameCount % spawnRate === 0) {
    zombies.push(new Zombie());
    if (score >= nextScoreMilestone) {
      spawnRate = max(fastestSpawnRate, spawnRate - 30);
      nextScoreMilestone += 4000;
    }
  }

  // update and draw zombies
  for (let i = zombies.length - 1; i >= 0; i--) {
    let z = zombies[i];
    z.update();
    z.display();

    if (z.isDead()) {
      if (z.type === "normal") score += 100;
      else if (z.type === "big") score += 200;
      else if (z.type === "fast") score += 150;
      zombies.splice(i, 1);
    } else if (z.y > height) {
      zombies.splice(i, 1);
      flash = true;
      pHealth--;
      if (pHealth <= 0) gameOver = true;
    }
  }

  // display player
  p.display();

  // bullets
  for (let i = bullets.length - 1; i >= 0; i--) {
    let b = bullets[i];
    b.update();
    b.display();
    if (b.y < 0) bullets.splice(i, 1);
  }

  // collisions
  for (let i = bullets.length - 1; i >= 0; i--) {
    let b = bullets[i];
    let hit = false;
    for (let j = zombies.length - 1; j >= 0; j--) {
      let z = zombies[j];
      if (abs(b.x - z.x) < 30 && abs(b.y - z.y) < 30) {
        z.takeDamage();
        hit = true;
        if (z.isDead()) {
          if (z.type === "normal") score += 100;
          else if (z.type === "big") score += 200;
          else if (z.type === "fast") score += 150;
          zombies.splice(j, 1);
        }
        break;
      }
    }
    if (hit) bullets.splice(i, 1);
  }
}

function startScreen() {
  fill(255, 0, 0);
  textAlign(CENTER, CENTER);
  textSize(40);
  text("END OF THE WORLD", width/2, height/2 - 80);
  textSize(20);
  fill(255);
  text("Controls:", width / 2, height / 2 - 20);
  textSize(15);
  text("Left/Right Arrow: Move", width / 2, height / 2 + 10);
  text("SPACE: Shoot", width / 2, height / 2 + 40);
  text("R: Reload", width / 2, height / 2 + 70);
  textSize(20);
  text("Press ENTER to Start", width / 2, height / 2 + 130);
}

function keyPressed() {
  if (keyCode === LEFT_ARROW) p.moveLeft();
  if (keyCode === RIGHT_ARROW) p.moveRight();

  if ((key === ' ' || keyCode === 32) && ammo > 0 && !reloading) {
    bullets.push(new Bullet(p.x, p.y));
    shootMode = true;
    ammo--;
    gunshot.play();
  }

  if (key === 'r' || key === 'R') {
    if (!reloading && ammo < maxAmmo) {
      reloading = true;
      reloadStart = millis();
      reload.play();
    }
  }

  if (!gameStarted && keyCode === ENTER) {
    gameStarted = true;
  }

  if (gameOver && (key === 'r' || key === 'R')) restartGame();
}

function keyReleased() {
  if (key === ' ') shootMode = false;
}

function restartGame() {
  zombies = [];
  bullets = [];
  score = 0;
  pHealth = 3;
  ammo = maxAmmo;
  reloading = false;
  gameOver = false;
  gameOverSoundPlayed = false;
  if (!music.isPlaying()) music.loop();
}

// === Player Class ===
class Player {
  constructor() {
    this.x = width / 2;
    this.y = height - 60;
  }

  display() {
    imageMode(CENTER);
    image(shootMode ? shootImg : playerImg, this.x, this.y, 80, 80);
  }

  moveLeft() {
    this.x = max(40, this.x - 15);
  }

  moveRight() {
    this.x = min(width - 40, this.x + 15);
  }
}

// === Bullet Class ===
class Bullet {
  constructor(x, y) {
    this.x = x;
    this.y = y;
    this.speed = 10;
  }

  update() {
    this.y -= this.speed;
  }

  display() {
    imageMode(CENTER);
    image(bulletImg, this.x, this.y, 15, 30);
  }
}

// === Zombie Class ===
class Zombie {
  constructor() {
    this.x = random(50, width - 50);
    this.y = -50;
    this.type = random(["normal", "big", "fast"]);
    this.health = this.type === "big" ? 3 : this.type === "fast" ? 1 : 2;
    this.speed = this.type === "fast" ? 5 : this.type === "big" ? 1 : 2;
  }

  update() {
    this.y += this.speed;
  }

  display() {
    imageMode(CENTER);
    if (this.type === "normal") image(zombieImg, this.x, this.y, 80, 80);
    else if (this.type === "big") image(bigZombieImg, this.x, this.y, 100, 100);
    else image(fastZombieImg, this.x, this.y, 70, 70);
  }

  takeDamage() {
    this.health--;
  }

  isDead() {
    return this.health <= 0;
  }
}

    class Bullet {
  constructor(startX, startY) {
    this.x = startX;
    this.y = startY;
    this.speed = 9;
  }

  update() {
    this.y -= this.speed;
  }

  display() {
    imageMode(CENTER);
    if (bulletImg) {
      image(bulletImg, this.x, this.y, 115, 115);
    }
  }
}

    class Player {
  constructor() {
    this.y = 420;
    this.slotWidth = width / 5;
    this.currentSlot = 2;
    this.health = 3;
    this.isHit = false;
  }

  display() {
    this.x = this.currentSlot * this.slotWidth + this.slotWidth / 2;

    imageMode(CENTER);
    if (shootMode) {
      image(shootImg, this.x, this.y, 360, 280);
    } else {
      image(playerImg, this.x, this.y, 340, 260);
    }
  }

  takeDamage() {
    this.health--;
    this.isHit = true;
  }

  moveLeft() {
    if (this.currentSlot > 0) this.currentSlot--;
  }

  moveRight() {
    if (this.currentSlot < 4) this.currentSlot++;
  }
}

class Zombie {
  float y = 0;
  float slotWidth = width / 5;
  int slot = int(random(0, 5)); //spawn zombies in random slots
  float speed;
  String type;
  PImage img;
  int health;         
  boolean isHit = false;  
  int hitTimer = 0;
  
//Randomly spawns types of zombies (normal, big, fast)
Zombie() {
  int r = int(random(100)); //100% (0-99)
  
  //Normal Zombie
  if (r < 50) {  //50% chance of spawning (0-49)
    type = "normal";
    img = zombieImg; health = 3; speed = 1.2;
    
  // Big Zombie
  } else if (r < 65) { //15% chance of spawning (50-64)
    type = "big" ;
    img = bigZombieImg; health = 6; speed = 1;
    
  // Fast Zombie 
  } else { //35% chance of spawning (65-99)
    type = "fast";
    img = fastZombieImg; health = 1; speed = 2;
  }
}

//zombies move down screen
  void update() {
    y += speed;
    
    // Glow fades after short time
    if (isHit && millis() - hitTimer > 90) {
      isHit = false;
    }

    // Check if zombie hits bottom
    if (y >= 450 && y < 460) {
      flash = true;
    }
  }
 
 
//display zombie image
 void display() {
    float x = slot * slotWidth + slotWidth / 2;
    imageMode(CENTER);
    if (isHit) {
      tint(255, 0, 0, 255); // red glow
    } else {
      noTint();
    }
    
    image(img, x, y);
    noTint();
  }
  
   void takeDamage() {
    health--;
    isHit = true;
    hitTimer = millis();
  }

  // Returns true if zombie are removed
    boolean isDead() {
    return health <= 0;
  }

  // For collision (approx. bounding box)
    float getX() {
    return slot * slotWidth + slotWidth / 2;
  }
}    
</script>
</body>
</html>
